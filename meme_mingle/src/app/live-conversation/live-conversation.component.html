
<app-navbar-main></app-navbar-main>
<div
  class="conversation-container"
  [ngClass]="{ 'dark-mode': isDarkMode }"
  [@fadeInOut]
>

  <!-- Initial Overlay -->
  <div *ngIf="showOverlay" class="overlay" [@overlayAnimation]>
    <div class="overlay-content">
      <h2>Welcome to AI Chat</h2>
      <p>Click below to start your conversation.</p>
      <button
        mat-raised-button
        color="primary"
        (click)="unlockAudio()"
        [@buttonClick]
      >
        Start Conversation
      </button>
    </div>
  </div>

  <!-- Conversation Area -->
  <div class="conversation-area">
    <div class="messages" #messagesContainer>
      <div
        *ngFor="let msg of conversation"
        class="message-wrapper"
        [ngClass]="msg.sender === 'User' ? 'User' : 'Mentor'"
        [@messageAnimation]
      >
      <div class="message">

        <img
          [src]="msg.sender === 'User' ? userProfilePicture : 'assets/img/banner.png'"
          alt="{{ msg.sender }} Avatar"
          class="avatar"
        />
        <div class="message-content">
          <!-- Text Messages -->
          <div class="text" [innerHTML]="msg.htmlContent"></div>
          <span class="timestamp">{{ msg.timestamp | date: 'shortTime' }}</span>

          <!-- Meme Images -->
          <ng-container *ngIf="msg.imageUrl">
            <img [src]="msg.imageUrl" alt="Meme" class="meme-image" />

          </ng-container>

        </div>

        <!-- Replay Button for Mentor Messages with Audio -->
        <button
          *ngIf="msg.audioUrl && msg.sender === 'Mentor'"
          mat-icon-button
          (click)="playAudio(msg.audioUrl)"
          matTooltip="Replay Audio"
          [@buttonClick]
        >
          <mat-icon>replay</mat-icon>
        </button>
      </div>

      
      </div>
      
    </div>
  </div>

  <!-- New Input Area -->
  <div class="input-area">
    <textarea
      [(ngModel)]="userInputText"
      placeholder="Type your message here..."
      (keydown.enter)="sendTextInput()"
    ></textarea>
    <label class="custom-file-label">
      <mat-icon>upload</mat-icon>
      <span>{{ selectedFileName || '' }}</span>
      <input type="file" class="file-input" (change)="onFileSelected($event)" />
    </label>
    
    <button
      mat-raised-button
      (click)="sendTextInput()"
      [@buttonClick]
      class="send-button"
    >
      Send
    </button>
  </div>

  <!-- Status Indicators -->
  <div class="status-indicators" [@fadeInOut]>
    <mat-progress-bar
      *ngIf="isProcessing"
      mode="indeterminate"
      color="accent"
    ></mat-progress-bar>
    <div *ngIf="isListening" class="status-message" [@statusAnimation]>
      <mat-icon>mic</mat-icon> Listening...
    </div>
    <div *ngIf="isPlaying" class="status-message" [@statusAnimation]>
      <mat-icon>volume_up</mat-icon> AI is speaking...
    </div>
  </div>

  <!-- Control Panel -->
  <div class="control-panel">
    <button
      mat-mini-fab
      color="warn"
      (click)="finalizeChat()"
      matTooltip="End Conversation"
      [@buttonClick]
    >
      <mat-icon>stop</mat-icon>
    </button>
    <button
      mat-mini-fab
      color="primary"
      (click)="toggleListening()"
      matTooltip="{{
        isListening ? 'Pause Listening' : 'Resume Listening'
      }}"
      [@buttonClick]
    >
      <mat-icon>{{ isListening ? 'pause' : 'play_arrow' }}</mat-icon>
    </button>
    <button
      mat-mini-fab
      (click)="toggleMute()"
      matTooltip="{{ isMuted ? 'Unmute' : 'Mute' }}"
      [@buttonClick]
    >
      <mat-icon>{{ isMuted ? 'volume_off' : 'volume_up' }}</mat-icon>
    </button>
  </div>
</div>